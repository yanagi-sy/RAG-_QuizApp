# RAG理解度テスト - 問題005

## 問題情報
- **問題番号**: 005
- **カテゴリ**: データフロー（流れ・仕組み）
- **難易度**: 中級
- **作成日時**: 2026-01-26 13:03:58

## 問題文

**Q5. このアプリのQA機能（/ask）の処理フローを説明してください。質問を受け取ってから回答を返すまでの各ステップ（ハイブリッド検索、RRF融合、リランキング、LLM生成）について、このアプリの実装に基づいて詳しく説明してください。**

---

## 回答欄

（ここに回答を記入してください）
質問を受け取る→引用候補を検索→候補をスコアリングしてランキング→クロスエンコーダーでリランキング→残った候補を使ってLLM生成
---

## 評価欄

### 理解度評価
- [x] レベル1（基礎）: 用語を説明できる、基本的な流れを理解している
- [ ] レベル2（応用）: 技術の仕組みを説明できる、手法の違いを理解している
- [ ] レベル3（実践）: 実装の詳細を説明できる、精度向上の方法を提案できる

### 評価コメント
**良い点：**
- 基本的な流れ（質問受付→検索→スコアリング→リランキング→LLM生成）を理解している
- 各ステップの順序を正しく把握している

**改善点：**
- 各ステップの詳細が不足している
  - **ハイブリッド検索**：`app/rag/hybrid_retrieval.py`で、semantic検索とkeyword検索を並行実行
  - **RRF融合**：`_merge_with_rrf`関数で、semantic_weightとkeyword_weightを使って順位を融合（RRFスコア = semantic_weight/(rrf_k+rank_sem) + keyword_weight/(rrf_k+rank_kw)）
  - **リランキング**：`app/search/reranker.py`のCross-Encoderで、上位rerank_n件を再スコアリング
  - **LLM生成**：`app/llm/prompt.py`でプロンプトを構築し、`app/llm/ollama.py`でLLMに送信
- 「引用候補を検索」という表現は正しいが、「候補をスコアリングしてランキング」はRRF融合のことを指していると思われる。より正確に説明できると良い

### 不足している知識
- ハイブリッド検索の具体的な実装（semantic検索とkeyword検索の並行実行）
- RRFの計算式とweightの役割
- Cross-Encoderリランキングの仕組みと計算コストが高い理由
- プロンプトの具体的な内容

### 改善点
- 各ステップの実装ファイルと処理内容を詳しく説明できるとレベル2に到達
- RRFの計算式やリランキングの閾値設定など、実装の詳細を説明できるとレベル3

---

## 参考情報

このアプリの実装を確認する場合:
- `backend/app/routers/ask.py` でQA機能の実装を確認
- `backend/app/rag/hybrid_retrieval.py` でハイブリッド検索の実装を確認
- `docs/09_技術スタックとデータフロー.md` でデータフローを確認
