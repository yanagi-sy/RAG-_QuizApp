# 基本設計書


## 1. システム構成

### 1.1 構成図（ASCII）
[Browser]
|
v
[Next.js Frontend]

QA画面（/）

クイズ画面（/quiz）
|
v HTTP(JSON)
[Python API (FastAPI)]

POST /ask

POST /quiz

POST /judge

GET /health
|
+--> [RAG]
| - docs/ 読み込み（txt/pdf）
| - Document化
| - Chunk分割
| - 検索（意味/キーワードのハイブリッド）
| - 引用抽出（最大5件）
|
+--> [LLM]
- 開発初期：Ollama
- 完成形：Gemini（LLM呼び出し差し替え）

markdown
コードをコピーする

## 2. 画面一覧

### 2.1 トップ（QA画面） `/`
- 質問入力 → 送信
- 回答表示（回答本文＋引用最大5件）
- （任意）ハイブリッド検索比率スライダー（意味↔キーワード）
- クイズ画面へのリンク（/quiz）

### 2.2 クイズ画面 `/quiz`
- 難易度選択（初級/中級/上級）
- 出題ボタン
- 問題文表示
- ○/×ボタン（回答）
- 判定結果表示（正誤＋解説＋引用最大5件）

## 3. データの流れ

### 3.1 QA（/ask）
1. フロント：質問文（＋任意で検索比率）を `POST /ask` に送信
2. バック：RAG検索で関連箇所を取得
3. バック：引用（最大5件）を整形
4. バック：LLMに「質問＋引用」を渡して回答生成
5. フロント：回答本文＋引用を表示

### 3.2 クイズ出題（/quiz）
1. フロント：難易度を `POST /quiz` に送信
2. バック：RAG（またはプロンプト）で○×問題を生成
3. バック：quiz_id を発行し、正解・解説・引用を in-memory に保持
4. フロント：quiz_id を保持し、問題文のみ表示

### 3.3 クイズ判定（/judge）
1. フロント：quiz_id＋回答（○/×）を `POST /judge` に送信
2. バック：quiz_id から保持データを取得
   - 見つからない場合：NOT_FOUND（再出題導線）
3. バック：正誤判定し、解説＋引用（最大5件）を返す
4. フロント：正誤＋解説＋引用を表示（回答後）

## 4. エラー時の扱い（方針）
- INVALID_INPUT：入力不備。フロントは入力箇所付近にエラー表示
- TIMEOUT / INTERNAL_ERROR / NETWORK_ERROR：再試行導線（同じリクエストを再送）
- NOT_FOUND（quiz_id）：再出題導線（/quiz を呼び直す）