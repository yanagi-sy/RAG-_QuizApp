# 進捗確認：設計書と現状実装の差分

## 1. 実装済み（設計書通り）

### 1.1 基盤・インフラ
- ✅ Next.js (App Router) + TypeScript + Tailwind CSS
- ✅ FastAPI + Python 3.11+
- ✅ CORS設定
- ✅ エラーハンドリング（統一形式：`{error: {code, message}}`）
- ✅ レスポンシブUI（PC/モバイル対応）

### 1.2 フロントエンド画面
- ✅ QA画面（`/`）：質問入力、回答表示、引用表示（最大5件）
- ✅ クイズ画面（`/quiz`）：難易度選択、問題表示、○×ボタン、判定結果表示
- ✅ ハイブリッド検索比率スライダー（UIのみ実装）

### 1.3 APIエンドポイント（骨格）
- ✅ `GET /health`：起動確認
- ✅ `POST /ask`：質問受付（ダミー実装）
- ✅ `POST /quiz`：クイズ生成（ダミー実装）
- ✅ `POST /judge`：クイズ判定（ダミー実装）
- ✅ `GET /docs/summary`：ドキュメントサマリー

### 1.4 ドキュメント処理（部分実装）
- ✅ ドキュメント読み込み（`manuals/`配下の`.txt`/`.pdf`）
- ✅ PDFテキスト抽出（PyMuPDF）
- ✅ チャンキング（LEN戦略）
- ✅ リポジトリルート基準のパス解決
- ✅ PDF読み込みエラーのログ出力

### 1.5 クイズ管理
- ✅ In-memoryストア（`quiz/store.py`）
- ✅ `NOT_FOUND`時の再出題導線

### 1.6 エラーUX
- ✅ エラーコード別の導線分岐（再試行/再出題）
- ✅ ローディング表示

---

## 2. 未実装（設計書との差分）

### 2.1 RAG検索機能（重要）
| 項目 | 設計書 | 現状 | 備考 |
|------|--------|------|------|
| Embedding生成 | 実装予定 | ❌ 未実装 | ベクトル化処理なし |
| ベクトルDB | 実装予定 | ❌ 未実装 | ベクトル保存・検索なし |
| 意味検索（Semantic Search） | 実装予定 | ❌ 未実装 | 類似度検索なし |
| キーワード検索 | 実装予定 | ❌ 未実装 | 全文検索なし |
| ハイブリッド検索 | 実装予定 | ⚠️ UIのみ | フロントで送信するがバックエンド未処理 |
| 引用抽出（最大5件） | 実装予定 | ❌ 未実装 | ダミー固定値のみ |

### 2.2 LLM統合（重要）
| 項目 | 設計書 | 現状 | 備考 |
|------|--------|------|------|
| LLMアダプタ層 | 実装予定 | ❌ 未実装 | `LLMClient`インターフェースなし |
| Ollama統合 | 開発初期に実装 | ❌ 未実装 | ローカルLLM呼び出しなし |
| Gemini統合 | 完成形で実装 | ❌ 未実装 | APIキー設定のみ（未使用） |
| プロンプト生成 | 実装予定 | ❌ 未実装 | 「質問＋引用」のプロンプト構築なし |
| 回答生成 | 実装予定 | ❌ 未実装 | ダミー固定値のみ |

### 2.3 API実装（ダミー状態）
| エンドポイント | 設計書の期待 | 現状 | 備考 |
|---------------|------------|------|------|
| `POST /ask` | RAG検索→LLM生成 | ❌ ダミー固定値 | 質問内容を無視 |
| `POST /quiz` | RAG検索→LLM生成 | ❌ ダミー固定値 | 難易度に応じた問題生成なし |
| `POST /judge` | 正誤判定＋解説生成 | ⚠️ 部分実装 | 正誤判定のみ、解説は固定値 |

### 2.4 クイズ生成ロジック
| 項目 | 設計書 | 現状 | 備考 |
|------|--------|------|------|
| 難易度別問題生成 | プロンプトテンプレート分岐 | ❌ 未実装 | レベル表示のみ |
| 判定不能回避 | 内部再生成 | ❌ 未実装 | 検証ロジックなし |
| 根拠検証 | 引用が取得できるか確認 | ❌ 未実装 | ダミー固定値 |

### 2.5 ドキュメント取り込み先
| 項目 | 設計書 | 現状 | 備考 |
|------|--------|------|------|
| 取り込み先 | `docs/` | ✅ `manuals/` | 運用変更済み（設計書と異なる） |

---

## 3. 実装状況サマリー

### 完成度
- **基盤・UI**: 約90%（画面・API骨格・エラーハンドリング）
- **RAG機能**: 約30%（読み込み・チャンキングのみ、検索未実装）
- **LLM統合**: 約0%（アダプタ層・呼び出し未実装）
- **全体**: 約40%（基盤は整備済み、コア機能は未実装）

### 次の実装ステップ（設計書の順序に従う）
1. ✅ **基盤の構築**（完了）
2. ⏳ **RAGの統合**（次フェーズ）
   - Embedding生成
   - ベクトルDB構築
   - 意味検索・キーワード検索実装
   - ハイブリッド検索統合
3. ⏳ **LLMの差し替え設計**（次フェーズ）
   - `LLMClient`インターフェース作成
   - Ollama実装
   - Gemini実装（将来）

---

## 4. 設計書との相違点（意図的な変更）

| 項目 | 設計書 | 現状 | 理由 |
|------|--------|------|------|
| ドキュメント取り込み先 | `docs/` | `manuals/` | 設計書とマニュアルを分離する運用方針 |
| パス解決 | 記載なし | リポジトリルート基準 | より堅牢な実装 |

---

## 5. 補足

- 現状は「ダミー実装」段階で、UI/UXとAPI骨格は完成
- RAG検索とLLM統合が未実装のため、実際の回答生成・クイズ生成は未動作
- 設計書の「段階的実装」方針に沿って、次はRAG統合フェーズ

---

## 6. 実装優先度（推奨順）

### 高優先度
1. Embedding生成（ベクトル化）
2. ベクトルDB構築（in-memoryまたは軽量DB）
3. 意味検索実装
4. LLMアダプタ層（`LLMClient`インターフェース）
5. Ollama統合

### 中優先度
6. キーワード検索実装
7. ハイブリッド検索統合
8. プロンプト生成ロジック
9. クイズ生成ロジック（難易度別）

### 低優先度
10. Gemini統合（完成形）
11. 判定不能回避ロジック（品質向上）
