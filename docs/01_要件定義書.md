# 要件定義書

# 要件定義書（MVP）v1.0

## 1. 目的・ゴール
- マニュアルを覚える必要のある新人が、マニュアルを参照しながら学習できるようにする
- 質問に対して、マニュアル根拠（引用）付きで回答を得られる（RAG QA）
- マニュアル内容に基づく **○×クイズ（初級/中級/上級）**を繰り返し解ける
  - 回答は **○/×ボタンの選択式**
  - 回答後に **正誤＋解説＋根拠（引用）** を表示（カンニング防止）

## 2. 対象ユーザー
- 職種を問わず、マニュアルを覚える必要のある新人
  - 例：オペレーター、営業、店舗スタッフ、事務、エンジニア等

## 3. システム概要
- フロント：Next.js
- バックエンド：Python API（FastAPI）
- LLM：
  - 開発初期はローカル（Ollama）で検証
  - 本プロジェクトの完成形として Gemini へ切り替え可能な構成にする（API I/F は維持し、LLM呼び出し部分のみ差し替える）

## 4. 機能要件

### 4.1 質問応答（RAG QA）
- ユーザーが自然言語で質問できる
- マニュアル参照に基づく回答を生成する
- 出力は **回答本文＋根拠（引用）** を含む
- 根拠（引用）は **最大5件** まで表示
- QA画面では、ハイブリッド検索比率（意味検索↔キーワード検索）を調整できる（任意）

### 4.2 クイズ生成（○×式）
- 難易度：初級 / 中級 / 上級
- マニュアル内容を元に **○×問題** を生成する
- 出題時は問題文のみ表示し、根拠（引用）は回答後表示のため内部保持する

### 4.3 クイズ判定（○×）
- ユーザーは **○/×ボタン**で回答する（選択式）
- 出力は **正誤＋解説＋根拠（引用）** を含む
- 根拠（引用）は **最大5件** まで表示
- 根拠（引用）は **回答後に表示**（カンニング防止）

### 4.4 判定不能をユーザーに出さない方針
- クイズ生成は必ず以下を満たす問題のみ採用する
  1) 根拠（引用）がマニュアルから取得できる  
  2) ○/×が一意に決まる（曖昧表現を避ける）  
  3) 解説が根拠と矛盾しない  
- 生成が不適切な場合は **内部的に再生成**し、ユーザーには出さない

## 5. 画面要件

### 5.1 トップ（QA画面）
- 質問入力
- 送信
- 回答表示（回答本文＋引用最大5件）
- クイズ画面へのナビゲーション
- （任意）ハイブリッド検索比率スライダー

### 5.2 クイズ画面
- 難易度選択（初級/中級/上級）
- 出題ボタン
- 問題文表示
- ○/×ボタン（回答）
- 判定結果表示（正誤＋解説＋引用最大5件）

## 6. API要件
- `POST /ask`：質問 → 回答＋引用
- `POST /quiz`：難易度 → quiz_id＋問題文（引用は内部保持）
- `POST /judge`：quiz_id＋回答（○/×） → 正誤＋解説＋引用
- `GET /health`：起動確認（200 OK）

## 7. 非機能要件
- 技術スタック：Next.js / Python(FastAPI) / Ollama（開発初期）＋ Gemini（完成形）
- 動作環境：ローカルPC（開発者端末）
- 応答時間：10秒以内が理想（超える場合はローディング表示・再試行導線でUXを担保）
- エラー時のUX：
  - NETWORK/TIMEOUT/INTERNAL：再試行導線
  - NOT_FOUND（quiz_id消失）：再出題導線
- ログ：API側で最低限のリクエスト/エラーを記録

## 8. データ保存方針
- DB保存なし（履歴・結果の永続保存はしない）
- クイズの quiz_id は **in-memory** 保持（API再起動で消える → NOT_FOUND）

## 9. マニュアル要件

### 9.1 取り込み方式（固定フォルダ方式）
- プロジェクト配下の `docs/` を参照
- `docs/` 配下の `.txt` / `.pdf` を一括取り込み対象とする

### 9.2 PDFの前提
- テキスト抽出可能なPDFのみ対象
- スキャン画像PDF（画像のみ）は対象外

### 9.3 取り込みタイミング
- API起動時に読み込み（更新UIは作らない）

## 10. 今回やらないこと
- ユーザー登録/ログイン
- 管理画面
- DB保存（永続化）

